[phases.install]
cmds = [
  "composer install --no-dev --no-interaction --prefer-dist --optimize-autoloader --no-scripts",
  "if [ -f package.json ]; then npm ci; fi"
]

[phases.build]
cmds = [
  "if [ -f package.json ]; then npm run build; fi",
  # Safe to best-effort cache without failing the build
  "php artisan config:cache || true",
  "php artisan route:cache || true",
  "php artisan view:cache || true",
  "php artisan storage:link || true"
]

[start]
cmd = "php artisan package:discover --ansi || true && php artisan migrate --force || true && php artisan serve --host 0.0.0.0 --port ${PORT}"